<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Agriculture Weather Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
  <header>
    <div class="header-container">
      <div class="logo-container">
        <img src="{{ url_for('static', filename='icons/logo2.png') }}" alt="WinifyAI Logo" class="logo">
        <div class="title-container">
          <h1>WinifyAI</h1>
          <span class="logo-tagline">Agricultural Intelligence</span>
        </div>
      </div>
      <nav>
        <a href="{{ url_for('home') }}" class="nav-link">
          <span class="nav-icon">🏠</span>
          <span>Home</span>
        </a>
        <a href="{{ url_for('dashboard') }}" class="nav-link">
          <span class="nav-icon">📊</span>
          <span>Weather Dashboard</span>
        </a>
        <a href="{{ url_for('chatbot') }}" class="nav-link active">
          <span class="nav-icon">💬</span>
          <span>Chatbot</span>
        </a>
      </nav>
    </div>
  </header>

  <div class="container">
    {% if error %}
      <p class="error">{{ error }}</p>
    {% endif %}

    <form method="post">
      <!-- Farm Selection Buttons -->
      <div class="farm-selection">
        <h2>Select Your Farm</h2>
        <div class="farm-buttons">
          <!-- Active Farms: They update a hidden field when clicked -->
          <button type="button" class="farm-button {% if selected_farm=='illinois' %}selected{% endif %}" data-farm="illinois">
            <img src="{{ url_for('static', filename='icons/farm1.jpg') }}" alt="Illinois Farm">
            <span>Farm 1 - Illinois</span>
          </button>
          <button type="button" class="farm-button {% if selected_farm=='north_dakota' %}selected{% endif %}" data-farm="north_dakota">
            <img src="{{ url_for('static', filename='icons/farm2.jpg') }}" alt="North Dakota Farm">
            <span>Farm 2 - North Dakota</span>
          </button>
          <!-- Disabled Farms -->
          <button type="button" class="farm-button disabled">
            <img src="{{ url_for('static', filename='icons/farm3.jpg') }}" alt="Oregon Farm">
            <span>Farm 3 - Oregon</span>
          </button>
          <button type="button" class="farm-button disabled">
            <img src="{{ url_for('static', filename='icons/farm4.jpg') }}" alt="Maine Farm">
            <span>Farm 4 - Maine</span>
          </button>
        </div>
      </div>
      <!-- Hidden input to store the selected farm -->
      <input type="hidden" name="farm" id="farm-input" value="{{ selected_farm or '' }}">

      <!-- Forecast Type Section -->
      <div class="form-section">
        <label for="forecast_type">Choose forecast type:</label>
        <div class="radio-group">
          <div class="radio-option">
            <input type="radio" id="hourly" name="forecast_type" value="hourly" required
                   {% if forecast_type == 'hourly' %} checked {% endif %}>
            <label for="hourly">Hourly Forecast (Next 24 Hours)</label>
          </div>
          <div class="radio-option">
            <input type="radio" id="daily" name="forecast_type" value="daily"
                   {% if forecast_type == 'daily' %} checked {% endif %}>
            <label for="daily">Daily Forecast (Next 7 Days)</label>
          </div>
        </div>
        <button type="submit">Get Forecast</button>
      </div>
    </form>

    {% if center_coords %}
      <div class="coordinates-card">
        <div class="coordinate-item">
          <span>Latitude</span>
          <p>{{ "%.6f"|format(center_coords[0]) }}</p>
        </div>
        <div class="coordinate-item">
          <span>Longitude</span>
          <p>{{ "%.6f"|format(center_coords[1]) }}</p>
        </div>
      </div>
    {% endif %}

<!-- Updated Forecast Design Without Buttons -->
{% if forecast_data %}
  <div class="forecast-data">
    {% if forecast_type == "hourly" %}
      <h2>Hourly Forecast (Next 24 Hours)</h2>
      <div class="swipe-container">
        {% for entry in forecast_data %}
          <div class="weather-card">
            <h3 class="forecast-date">{{ entry.date }}</h3>
            <div class="weather-details">
              <div class="temperature">🌡️ Temp: <strong>{{ entry.temperature }}°C</strong></div>
              <div class="precipitation">🌧️ Precip: <strong>{{ entry.precipitation }} mm</strong></div>
              <div class="humidity">💧 RH: <strong>{{ entry.relative_humidity }}%</strong></div>
              <div class="wind">💨 Wind: <strong>{{ entry.wind_speed }} km/h</strong></div>
            </div>
          </div>
        {% endfor %}
      </div>
    {% elif forecast_type == "daily" %}
      <h2>Daily Forecast (Next 7 Days)</h2>
      <div class="swipe-container">
        {% for entry in forecast_data %}
          <div class="weather-card">
            <h3 class="forecast-date">{{ entry.date }}</h3>
            <div class="weather-details">
              <div class="temperature">
                🌡️ Max: <strong>{{ entry.temp_max }}°C</strong>
                / Min: <span class="low-temp">{{ entry.temp_min }}°C</span>
              </div>
              <div class="precipitation">🌧️ Precip: <strong>{{ entry.precipitation_sum }} mm</strong></div>
              <div class="wind">💨 Wind: <strong>{{ entry.wind_speed_max }} km/h</strong></div>
              <div class="uv-index">☀️ UV Index: <strong>{{ entry.uv_index }}</strong></div>
            </div>
          </div>
        {% endfor %}
      </div>
    {% endif %}
  </div>
{% endif %}



  <footer>
    <p>Agriculture Weather Dashboard &copy; {{ now.year }}</p>
  </footer>

  <script>
    document.addEventListener("DOMContentLoaded", function() {
      // JavaScript to handle active farm button selection
      const farmButtons = document.querySelectorAll('.farm-button');
      const farmInput = document.getElementById('farm-input');

      farmButtons.forEach(button => {
        if (!button.classList.contains('disabled')) {
          button.addEventListener('click', function() {
            // Remove "selected" class from all active farm buttons
            farmButtons.forEach(btn => {
              if (!btn.classList.contains('disabled')) {
                btn.classList.remove('selected');
              }
            });
            // Add "selected" class to the clicked button and update the hidden input
            this.classList.add('selected');
            const selectedFarm = this.getAttribute('data-farm');
            console.log("Selected farm:", selectedFarm); // Debug log
            farmInput.value = selectedFarm;
          });
        }
      });
    });
  </script>
</body>
</html>
